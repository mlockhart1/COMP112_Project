---
title: "Visualization Summaries"
author: "Michael Lockhart"
date: "12/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(readr)
library(tidyverse)
library(readxl)
library(maps)
library(ggthemes)
library(ggmap)
library(ggplot2)
library(lubridate)
library(babynames)
library(plotly)
library(gganimate) 
library(gifski) 
```

```{r, message=FALSE}
nbaStats <- read_csv("nbaStats.csv")
```

```{r, message=FALSE}
NBA_Players_by_State <- read_excel("NBA Players by State.xlsx") %>% 
  mutate(State= ifelse(State== "Washingon", "Washington", State))
```

```{r}
NBA_Players_birthplace <- NBA_Players_by_State %>% 
  select(Player, Date, City, State)
```



```{r}
nbaNew <- nbaStats %>% 
  select(Player, Status, Pos, labels, g, mp, FG, FGA, `3P`, 
         `3PA`, FTA, `FT%`, TRB, AST, STL, TOV, PTS) %>% 
  left_join(NBA_Players_birthplace, by = "Player") %>% 
  filter(!is.na(Date)) %>% 
  filter(!is.na(City)) %>% 
  mutate(state_new= tolower(ifelse(State=="DC", "district of columbia", State))) 
```

```{r}
state_data <- tibble(name = str_to_lower(state.name), 
                     code = state.abb) 

nba_players_map <-NBA_Players_birthplace %>%
  mutate(state_new= tolower(ifelse(State=="DC", "district of columbia", State))) %>% 
  group_by(state_new) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  left_join(state_data, by= c("state_new" = "name")) %>% 
  mutate(code= ifelse(state_new== "district of columbia", "DC", code))
```

```{r}
state_data <- tibble(name = str_to_lower(state.name), 
                     code = state.abb)
```


```{r}
nba_players_map 

  
  
l <- list(color = toRGB("white"), width = 2) 

g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = TRUE,
  lakecolor = toRGB('white'))

plot_geo(nba_players_map, locationmode = 'USA-states') %>%
  add_trace(
    z = ~n, text = ~str_to_title(state_new), locations = ~code,
    color = ~n, colors = 'Blues'
  ) %>%
  colorbar(title = "Number of Players") %>%
  layout(
    title = "Number of Players in the NBA per State (1996-2016 Seasons)",
    geo = g
  )

```


```{r}
dist_countries <- all_seasons %>% 
  group_by(season) %>% 
  distinct(country) %>% 
  count(country) %>% 
  summarise(total_countries = sum(n)) 
```

```{r}
  total_countries <- ggplot(dist_countries, aes(x = season, y = total_countries))+
  geom_col()+
  coord_flip()+
  labs(title = "Number of Countries Represented in the NBA per Season", x = "NBA Season" , y = "Total Number of Countries") 
  
ggplotly(total_countries)
```

**Figure 2** 
This graph illustrates the total number of countries represented in the NBA. Representation is based on the nationality of players in the NBA. The dataset is comprised of entries from the 1996-2016 seasons.



```{r}
dist_players <- all_seasons %>% 
distinct(player_name,.keep_all = TRUE) %>% 
  select(player_name, country, draft_number)
```



```{r, fig.height= 10, fig.width= 8}
country_mean <- dist_players%>% 
  filter(country != "USA") %>% 
  filter(draft_number != "undrafted") %>% 
  filter(draft_number != "Undrafted") %>% 
  mutate(draft_pos = as.numeric(draft_number)) %>% 
  group_by(country) %>%  
  summarize(mean = mean(draft_pos), total = n()) %>%
  arrange(desc(mean))
  
plot <- country_mean %>%   
  ggplot(aes(x=fct_inorder(country), y=mean)) +
 geom_point(aes(size = total))+
  coord_flip()+
  labs(title = "Average Draft Position of Players per Country", x= "Country", y= "Average Draft Position" )

```

```{r, fig.height=10, fig.width=8}
ggplotly(plot)
```




**Figure 4**
This graph shows the average draft position of players selected in the NBA draft from specific countries. We used draft position to refer to the subjective value of players entering the NBA.   


