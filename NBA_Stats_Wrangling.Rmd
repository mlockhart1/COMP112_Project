---
title: "NBA Stats Dataset"
author: "Michael Lockhart"
date: "11/19/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(readr)
library(tidyverse)
library(readxl)
library(maps)
library(ggthemes)
library(ggmap)
library(ggplot2)
```


```{r, message=FALSE}
nbaStats <- read_csv("nbaStats.csv")
```

```{r}
NBA_Players_by_State <- read_excel("NBA Players by State.xlsx")
```

# NBA_Players_by_State Variable Key

player: Player first and last name
yrs: number of years played
g: games
mp: minutes played
fg: field goals
fga: field goal attempts
3p: 3-point field goals
3pa: 3-point field goal attempts
ft: free throws
fta: free throw attempts
orb: offensive rebounds
trb: total rebounds
ast: assists
stl: steals
blk: blocks
tov: turnovers
pf: personal fouls
pts: points
fg_2: field goal percentage
3p_2: 3-point field goal percentage
ft_2: free throw percentage
mp_2: minutes played per game
pts_2: points per game
trb_2: total rebounds per game
ast_2: assists per game
date: birth date
city: birth city
state: birth state


```{r, message=FALSE}
Player_Stats_1996_2016 <- read_csv("all_seasons.csv")
```

```{r}
NBA_Players_birthplace <- NBA_Players_by_State %>% 
  select(Player, Date, City, State)
```


```{r}
nbaNew <- nbaStats %>% 
  select(Player, Status, Pos, labels, g, mp, FG, FGA, `3P`, 
         `3PA`, FTA, `FT%`, TRB, AST, STL, TOV, PTS) %>% 
  left_join(NBA_Players_birthplace, by = "Player") %>% 
  filter(!is.na(Date)) %>% 
  filter(!is.na(City)) %>% 
  mutate(state_new= tolower(ifelse(State=="DC", "district of columbia", State))) 
```

```{r}
games_per_state <- nbaNew %>% 
  group_by(state_new) %>% 
  filter(Status == "Active") %>% 
  summarise(games = sum(g)) %>% 
  arrange(desc(games))
```


```{r fig.width=10}
states_map <- map_data("state")

games_per_state %>% 
  ggplot(aes(fill = games)) +
  geom_map(aes(map_id = state_new), map = states_map) +
  expand_limits(x = states_map$long, y = states_map$lat) + 
  theme_map()+
  scale_fill_distiller(palette = "Spectral")+
  labs(title = "Games Played per State by Active Players as of 2017")

```

```{r}
PTS_per_State <- nbaNew %>% 
  group_by(state_new) %>% 
  filter(Status == "Active") %>% 
  summarise(pts_avg = mean(PTS)) %>% 
  arrange(desc(pts_avg))
```


```{r fig.width=10}
states_map <- map_data("state")

PTS_per_State %>% 
  ggplot(aes(fill = pts_avg)) +
  geom_map(aes(map_id = state_new), map = states_map) +
  expand_limits(x = states_map$long, y = states_map$lat) + 
  theme_map()+
  scale_fill_distiller(palette = "Spectral") +
  labs(title = "Points Scored per State by Active Players as of 2017")

```



